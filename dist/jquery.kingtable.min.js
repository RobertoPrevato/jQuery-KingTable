/*!
 * jQuery-KingTable.
 * https://github.com/RobertoPrevato/jQuery-KingTable
 *
 * Copyright 2015, Roberto Prevato
 * http://ugrose.com
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
R("extend",[],function(){return function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.__super__=d.prototype,c}}),R("events",[],function(){var a=[],b=(a.push,a.slice),c=(a.splice,{on:function(a,b,c){if(!e(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!e(this,"once",a,[b,c])||!b)return this;var d=this,f=_.once(function(){d.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,c)},off:function(a,b,c){var d,f,g,h,i,j,k,l;if(!this._events||!e(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:_.keys(this._events),i=0,j=h.length;j>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=d=[],b||c)for(k=0,l=g.length;l>k;k++)f=g[k],(b&&b!==f.callback&&b!==f.callback._callback||c&&c!==f.context)&&d.push(f);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var c=b.call(arguments,1);if(!e(this,"trigger",a,c))return this;var d=this._events[a],g=this._events.all;return d&&f(d,c),g&&f(g,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}}),d=/\s+/,e=function(a,b,c,e){if(!c)return!0;if("object"==typeof c){for(var f in c)a[b].apply(a,[f,c[f]].concat(e));return!1}if(d.test(c)){for(var g=c.split(d),h=0,i=g.length;i>h;h++)a[b].apply(a,[g[h]].concat(e));return!1}return!0},f=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},g={listenTo:"on",listenToOnce:"once"};return _.each(g,function(a,b){c[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=_.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),c}),R("string",[],function(){return{format:function(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},compare:function(a,b,c,d){if(c=_.isNumber(c)?c:/^asc/i.test(c)?1:-1,a&&!b)return c;if(!a&&b)return-c;if(!a&&!b)return 0;if(a==b)return 0;var e={characters:"AÁÀÂÄÃĀĂĄÃÅÆBCĆÇDEÈÉÊËĘFGHIÌÍÎÏJKLŁMNÑŃOÒÓÔÕÖØPQRSŚŠTUÙÚÛÜVWYÝŸZŹŻŽąàáâãäåæbcçćdeęèéêëfghiìíîïjklłmnñńoòóôõöøpqrsśštuùúûüvwyýÿzźżž",caseSensitive:!1},f=$.extend(e,d||{}),g=f.characters,h=f.caseSensitive,i=h?a:a.toLowerCase(),j=h?b:b.toLowerCase(),k=0,l=Math.min(a.length,b.length);if(i==j)return 0;for(;i.charAt(k)===j.charAt(k)&&l>k;)k++;var m=g.indexOf(i.charAt(k)),n=g.indexOf(j.charAt(k));return m>-1&&n>-1?m>n?c:-c:j>i?-c:c},removeHiphens:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},repeat:function(a,b){return new Array(parseInt(b)+1).join(a)},getString:function(a){return"string"==typeof a?a:a.toString?a.toString():""},trimLeft:function(a){return a.replace(/^[\s]+/g,"")},trimRight:function(a){return a.replace(/[\s]+$/g,"")},trim:function(a){return a.replace(/^[\s]+|[\s]+$/g,"")},removeSpaces:function(a){return a.replace(/\s/g,"")},removeMultipleSpaces:function(a){return a.replace(/\s{2,}/g," ")},toTitleCase:function(a){return a.toLowerCase().replace(/^(.)|\s+(.)/g,function(a){return a.toUpperCase()})},sanitizeSpaces:function(a){return this.removeLeadingSpaces(this.removeMultipleSpaces(a))}}}),R("regex",[],function(){return{escapeCharsForRegex:function(a){return"string"!=typeof a&&(a+=""),a.replace(/([\^\$\.\(\)\[\]\?\!\*\+\{\}\|\/\\])/g,"\\$1").replace(/\s/g,"\\s")},getSearchPattern:function(a,b){if(!a)return/.+/gim;switch(b=_.extend({searchMode:"fullstring"},b||{}),b.searchMode.toLowerCase()){case"fullstring":a=this.escapeCharsForRegex(a);try{return new RegExp("("+a+")","mgi")}catch(c){return}break;default:throw"invalid searchMode"}},getMatchPattern:function(a){if(!a)return/.+/gm;a=this.escapeCharsForRegex(a);try{return new RegExp(a,"i")}catch(b){throw b}},safeTest:function(a,b){return b?!!b.match(a):!1}}}),R("date",[],function(){function a(a,b){for("string"!=typeof a&&(a=a.toString());a.length<b;)a="0"+a;return a}var b={year:{rx:/Y{1,4}/,fn:function(a,b){for(var c=a.getFullYear().toString();c.length>b.length;)c=c.substr(1,c.length);return c}},month:{rx:/M{1,4}/,fn:function(b,c,d,e){var f=(b.getMonth()+1).toString();switch(c.length){case 1:return f;case 2:return a(f,2);case 3:return e.monthShort[f];case 4:return e.month[f]}}},day:{rx:/D{1,4}/,fn:function(b,c,d,e){var f=b.getDate().toString();switch(c.length){case 1:return f;case 2:return a(f,2);case 3:return e.dayShort[f];case 4:return e.day[f]}}},hour:{rx:/h{1,2}/i,fn:function(a,b,c){var d=a.getHours(),e=/t{1,2}/.test(c);for(e&&d>12&&(d%=12),d=d.toString();d.length<b.length;)d="0"+d;return d}},minute:{rx:/m{1,2}/,fn:function(a,b){for(var c=a.getMinutes().toString();c.length<b.length;)c="0"+c;return c}},second:{rx:/s{1,2}/,fn:function(a,b){for(var c=a.getSeconds().toString();c.length<b.length;)c="0"+c;return c}},millisecond:{rx:/f{1,4}/,fn:function(a,b){for(var c=a.getMilliseconds().toString();c.length<b.length;)c="0"+c;return c}},hoursoffset:{rx:/z{1,3}/i,fn:function(b,c,d){var e=-(b.getTimezoneOffset()/60),f=e>0?"+":"";switch(c.length){case 1:return f+e;case 2:return f+a(e,2);case 3:return f+a(e,2)+":00"}}},ampm:{rx:/t{1,2}/i,fn:function(a,b){var c,d=a.getHours(),e=/T{1,2}/.test(b);switch(b.length){case 1:c=d>12?"p":"a";break;case 2:c=d>12?"pm":"am"}return e?c.toUpperCase():c}},weekday:{rx:/w{1,2}/i,fn:function(a,b,c,d){var e=a.getDay(),f=b.length>1?"week":"weekShort",g=d[f];return g&&void 0!==g[e]?g[e]:e}}};return{format:function(a,c,d){var e=c;for(var f in b){var g=b[f],h=c.match(g.rx);h&&(e=e.replace(g.rx,g.fn(a,h[0],c,d)))}return e}}}),R("reflection",[],function(){return{getPropertyValue:function(a,b){for(var c,d=b.split("."),e=a;(c=d.shift())&&(e.hasOwnProperty(c)&&(e=e[c]),!(e instanceof Array)););return e instanceof Array&&d.length?this.getCollectionPropertiesValue(e,d.join(".")):e},getCollectionPropertiesValue:function(a,b,c){if(!b)return a;"boolean"!=typeof c&&(c=!1);for(var d=b.split("."),e=[],f=0,g=a.length;g>f;f++){var h=a[f];if(h.hasOwnProperty(d[0]))if(h instanceof Array){var i=this.getCollectionPropertiesValue(h,b);(c||i.length)&&e.push(i)}else if("object"==typeof h){var j=this.getPropertyValue(h,b);(c||this.validateValue(j))&&e.push(j)}else(c||this.validateValue(h))&&e.push(h);else c&&e.push(null)}return e},validateValue:function(a){return a?a instanceof Array?!!a.length:!0:!1}}}),R("array-search",["string","reflection"],function(a,b){return{sortByProperty:function(b,c,d){d=_.isNumber(d)?d:/^asc/i.test(d)?1:-1;var e=void 0;return b.sort(function(b,f){var g=b[c],h=f[c];return g!==e&&h===e?-d:g===e&&h!==e?d:g&&!h?d:!g&&h?-d:"string"==typeof b[c]&&"string"==typeof f[c]?a.compare(g,h,d):h>g?-d:g>h?d:0}),b},searchByStringProperty:function(a){return this.searchByStringProperties(_.extend(a,{properties:[a.property]}))},searchByStringProperties:function(a){var c={order:"asc",limit:null,keepSearchDetails:!1,getResults:function(a){if(this.keepSearchDetails)return a;for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].obj);return b}},d=$.extend({},c,a);d.order&&d.order.match(/asc|ascending|desc|descending/i)||(d.order="asc");var e=[],f=d.pattern;if(!f instanceof RegExp)throw new Error("the pattern must be a regular expression");for(var g=d.properties,h="length",i=0,j=d.collection[h];j>i;i++){for(var k=d.collection[i],l=[],m=0,n=0,o=g[h];o>n;n++){var p=g[n],q=b.getPropertyValue(k,p);if(q)if(q.match||(q=q.toString()),q instanceof Array){if(!q[h])continue;q=_.flatten(q);for(var r,s=[],t=0,j=q[h];j>t;t++){var u=q[t].match(f);u&&("number"!=typeof r&&(r=t),s.push(u))}s[h]&&(l[n]={matchedProperty:p,indexes:[r],recourrences:_.flatten(s)[h]})}else{var u=q.match(f);u&&(m+=u[h],l[n]={matchedProperty:p,indexes:_.map(q.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ").split(/\s/),function(a){var b=a.search(f);return-1==b?1/0:b}),recourrences:u[h]})}}l[h]&&e.push({obj:k,matches:l,totalMatches:m})}var v=d.order.match(/asc|ascending/i)?1:-1,w="toLowerCase",x="toString",y="matches",z="matchedProperty",A="indexOf",B="hasOwnProperty",C="recourrences",k="obj",D="indexes";e.sort(function(a,b){for(var c=0,d=g[h];d>c;c++){var e=a[y][c],f=b[y][c];if(e||f){if(e&&!f)return-v;if(!e&&f)return v;var i=_.min(e[D]),j=_.min(f[D]);if(!i||!j){if(j>i)return-v;if(i>j)return v;if(e[D][A](i)<f[D][A](j))return-v;if(e[D][A](i)>f[D][A](j))return v}var l=a[k],m=b[k];if(l[B](e[z])&&m[B](f[z])){if(l[e[z]][x]()[w]()<m[f[z]][x]()[w]())return-v;if(l[e[z]][x]()[w]()>m[f[z]][x]()[w]())return v}if(e[C]>f[C])return-v;if(e[C]<f[C])return v}}return 0});var E=d.limit;return E&&(e=e.slice(0,_.min(E,e[h]))),d.getResults(e)}}}),R("object-analyzer",["reflection"],function(a){var b=function(){};return _.extend(b.prototype,{getObjectStructure:function(a,b){var c={};b=_.extend({clear:!1,flat:!1},b||{});for(var d in a)b.flat?c[d]=this.getType(a[d]):c[d]={name:d,type:this.getType(a[d])};return b.clear?this.clearSchema(c):c},getCollectionStructure:function(a,b){var c={};b=$.extend({clear:!1,flat:!1},b||{});for(var d=_.isNumber(b.limit)?b.limit:a.length,e=0;d>e;e++){var f=this.getObjectStructure(a[e],b);for(var g in f)c.hasOwnProperty(g)?void 0!=f[g].type&&c[g].type!=f[g].type&&(void 0==c[g].type?c[g].type=f[g].type:c[g].type="string"):_.extend(c,f)}return b.clear?this.clearSchema(c):c},clearSchema:function(a){for(var b in a)void 0==a[b].type&&delete a[b];return a},getType:function(a){return null!=a&&void 0!=a?"string"==typeof a&&/(\d{4}).(\d{2}).(\d{2})\s*((\d{2}).(\d{2}))*/.test(a)?"date":a instanceof Array?"array":a instanceof Date?"date":a instanceof RegExp?"regex":typeof a:void 0},analyze:function(a){var b=[];for(var c in a)b.push(c+" is: "+this.getType(a[c])),"object"!=typeof a[c]||a[c]instanceof Array||(b=b.concat(this.analyze(a[c])));return b},listProperties:function(b,c){var d=[];c||(c="");var e=c?a.getPropertyValue(b,c):b;for(var f in b){this.getType(b[f]);if(d.push({name:c+f,type:this.getType(e[f])}),"object"==typeof b[f])if(b[f]instanceof Array){if(b[f].length){var g=(b[f][0],this.listProperties(b[f][0],c+f+"."));d=d.concat(g)}}else{var g=this.listProperties(b[f],c+f+".");d=d.concat(g)}}return d},listProperties:function(b,c){var d=[];c||(c="");var e=c?a.getPropertyValue(b,c):b;for(var f in b){this.getType(b[f]);if(d.push({name:c+f,type:this.getType(e[f])}),"object"==typeof b[f])if(b[f]instanceof Array){if(b[f].length){var g=(b[f][0],this.listProperties(b[f][0],c+f+"."));d=d.concat(g)}}else{var g=this.listProperties(b[f],c+f+".");d=d.concat(g)}}return d},guessSearchableProperties:function(a,b){var c=[];b||(b="");for(var d in a)if(!_.contains(["id","guid","rowcount","rownumber","rownum","thmguid"],d.toLowerCase())){var e=this.getType(a[d]);if(_.contains(["string","number"],e)&&c.push(b+d),"object"==typeof a[d])if(a[d]instanceof Array){if(a[d].length){var f=(a[d][0],this.guessSearchableProperties(a[d][0],b+d+"."));c=c.concat(f)}}else{var f=this.guessSearchableProperties(a[d],b+d+".");c=c.concat(f)}}return c},guessFilterableProperties:function(a,b){var c=[];b||(b="");for(var d in a)if(!/_formatted$/.test(d)&&!_.contains(["id","guid","rowcount","rownumber","rownum","thmguid"],d.toLowerCase())){var e=this.getType(a[d]);_.contains(["object","regex","array"],e)||c.push({name:d,displayName:I.lookup("words."+d)?I.t("words."+d):d,type:e,include:"number"==e?{number:["equals","greaterThan","lessThan"],numberRange:["between"]}:null})}for(var f={},g=0,h=c.length;h>g;g++)f[c[g].name]=c[g];return f}}),b}),R("sanitizer",[],function(){var a=function(){};return _.extend(a.prototype,{sanitize:function(a){for(var b in a)if("string"==typeof a[b])a[b]=this.escape(a[b]);else if("object"==typeof a[b])if(a[b]instanceof Array)for(var c=0,d=a[b].length;d>c;c++)a[b][c]=this.sanitize(a[b][c]);else a[b]=this.sanitize(a[b]);return a},escape:function(a){return a.replace(/</g,"(").replace(/>/g,")")}}),a}),R("query",[],function(){return{get:function(a){return this.getAll()[a]},getAll:function(){var a,b,c,d={},e=/\?|\&/,f=location.search.split(e),g=location.hash.match(/(\?.+)$/);for(g&&(f=f.concat(g[1].split(e))),a=0,b=f.length;b>a;a++)c=f[a],c&&(c=c.split(/=/),d[c[0]]=decodeURIComponent(c[1]));return d},set:function(a,b){var c="invalid parameter";if("object"==typeof a){if(a instanceof Array)throw c;for(var d in a)this.set(d,a[d]);return this}if(!a)throw c;var e=location.hash;if(!e)return location.hash="#/?"+a+"="+b;var f=this.getAll();null===b||""===b?delete f[a]:f[a]=b,location.hash=this.getHashForParams(f)},getHashForParams:function(a){var b,c=location.hash,d=[];for(b in a)d.push(b+"="+encodeURIComponent(a[b]));if(d=d.length?"?"+d.join("&"):"",!c)return"#/"+d;var e=c.indexOf("?");return e>-1?c.substring(0,e)+d:c+d}}}),R("file",[],function(){return{supportsCsExport:function(){return navigator.msSaveBlob||function(){var a=document.createElement("a");return void 0!==a.download}()},exportfile:function(a,b,c){var d="setAttribute",e=navigator.msSaveBlob,f=new Blob([b],{type:c});if(e)e(f,a);else{var g=document.createElement("a");if(void 0!==g.download){var h=URL.createObjectURL(f);g[d]("href",h),g[d]("download",a);var i={visibility:"hidden",position:"absolute",left:"-9999px"};for(var j in i)g.style[j]=i[j];document.body.appendChild(g),g.click(),document.body.removeChild(g)}}}}}),R("csv",[],function(){var a={allStrings:1,keepType:2};return{typeHandling:a,defaults:{separator:",",addSeparatorLine:!1,typeHandling:a.allStrings},serialize:function(b,c){c=_.extend({},this.defaults,c);var d=[],e="push",f="toString",g="length",h="replace",i="test",j=c.separator,k='"';c.addSeparatorLine&&d[e]("sep="+j);for(var l=0,m=b[g];m>l;l++){for(var n=[],o=b[l],p=0,q=o[g];q>p;p++){var r=o[p];r instanceof Date?r=r.toLocaleString():"string"!=typeof r&&(r=r[f]?r[f]():""),r=r[h](/"/g,'""'),/"/[i](r)&&(r=r[h](/"/g,'""')),(c.typeHandling==a.allStrings||/"|\n/[i](r)||r.indexOf(j)>-1)&&(r=k+r+k),n[e](r)}d[e](n.join(j))}return d.join("\n")}}}),R("i18n",[],function(){if(window.I)return window.I;if(window.I18n)return window.I18n;throw"Missing implementation of i18n. Please refer to https://github.com/RobertoPrevato/jQuery-KingTable/wiki/Implementing-localization"}),R("menu-builder",[],function(){function a(a){if(!a||!a.attr)return"";var c=[],d='"',e=a.attr;for(var f in e)c.push([b[f]?b[f]:f,"=",d,e[f],d].join(""));return c.join(" ")}var b={css:"class"},c=function(b){if(!b)throw"missing menus";if(_.isPlainObject(b))return c([b]);if(!b instanceof Array||!b.length)throw"missing menus";var d=b[0];!d.items&&d.menu&&(b=[{items:b}]);var e="push",f=[],g='<span class="oi" data-glyph="caret-right"></span>';return _.each(b,function(b){var d=b.id;f[e]("<ul"+(d?' id="'+d+'"':"")+' class="ui-menu">'),_.each(b.items,function(b){if(null!==b){var d=b.menu,h=b.type,i=b.href,j=b.name;switch(f[e]("<li"+(d?' class="ui-submenu">':">")),h){case"checkbox":var k=_.uniqueId("mnck-"),l=b.checked?' checked="checked"':"";f[e]('<input id="'+k+'" type="checkbox"'+a(b)+l+" />"),f[e]('<label for="'+k+'">'+j+"</label>");break;case"radio":if(!b.value)throw"missing value for radio";var k=_.uniqueId("mnrd-");f[e]('<input id="'+k+'" type="radio" value="'+b.value+'"'+a(b)+" />"),f[e]('<label for="'+k+'">'+j+"</label>");break;default:i?f[e]('<a href="'+i+'"'+a(b)+">"+j+(d?g:"")+"</a>"):f[e]('<span tabindex="0"'+a(b)+">"+j+(d?g:"")+"</span>")}d&&f[e](c([b.menu])),f[e]("</li>")}}),f[e]("</ul>")}),f.join("")};return c}),R("menu-functions",[],function(){function a(a){return/input|select|textarea|label/i.test(a.target.tagName)}function b(a){a.preventDefault()}function c(a){var b="length",c="find",d=":first-of-type",e=a[c]("a"+d);return e[b]?e:(e=a[c]("span[tabindex]"+d),e[b]?e:e=a[c]("label"+d))}function d(d){if(a(d)&&!$(d.target).closest(".ui-menu").length)return!0;var e=d.which;if(9===e)return!0;var g=!!$(".ui-menu:visible").length,h=$(":focus"),i="focus";if(g&&/27|37|38|39|40/.test(e)){if(b(d),27==e)return f.closeMenus(),!0;var j=h.length&&h.closest(".ui-menu").length?h:c($($(".ui-menu:visible")[0]).find("li:first")),k=j.parent();if(h.hasClass("ui-expander"))return c(k).trigger(i),!0;if(38==e){var l=h.prev(),m=l.hasClass("ui-menu");m?c(l.children(":first")).trigger(i):c(k.prev()).trigger(i)}if(40==e){var n=h.next(),o=n.hasClass("ui-menu");o&&!k.hasClass("ui-submenu")?c(n.children(":first")).trigger(i):c(k.next()).trigger(i)}if(37==e){var p=k.closest(".ui-submenu");p.length&&(p.get(0)===k.get(0)&&(p=p.parent().closest(".ui-submenu")),p.length&&(p.removeClass("open"),_.defer(function(){c(p).trigger(i)})))}return 39==e&&k.hasClass("ui-submenu")&&(k.trigger("click"),_.defer(function(){c(k.find("li:first-of-type")).trigger(i)})),!0}}var e=".ui-menu,.ui-submenu",f={closeMenus:function(b){if(b&&a(b))return!0;var c=this;b&&3===b.which||$(e).each(function(){var a=$(this),d=c.getParent(a);d.hasClass("open")&&(b&&"click"==b.type&&/input|textarea/i.test(b.target.tagName)&&$.contains(d[0],b.target)||b&&b.isDefaultPrevented()||(a.attr("aria-expanded","false"),d.removeClass("open")))})},getParent:function(a){var b=a.attr("data-target");b||(b=a.attr("href"),b=b&&/#[A-Za-z]/.test(b)&&b.replace(/.*(?=#[^\s]*$)/,""));var c=b&&$(b);return c&&c.length?c:a.parent()},expandMenu:function(b){if(a(b))return!0;var c=this,d=$(b.currentTarget);if(!d.is(".disabled, :disabled")){var e=c.getParent(d),f=e.hasClass("open");if(c.closeMenus(b),!f){if(b.isDefaultPrevented())return;d.trigger("focus").attr("aria-expanded","true"),e.toggleClass("open")}return!1}},expandSubMenu:function(b){if(a(b))return!0;var c="open",d=$(b.currentTarget);return d.siblings().removeClass(c).find("."+c).removeClass(c),d.addClass(c),!1}},g="bind";return $(document).on("click.menus",f.closeMenus[g](f)).on("click.menus",e,f.expandMenu[g](f)).on("keydown.menus",d),f}),R("menu",["menu-builder","menu-functions"],function(a,b){return{builder:a,functions:b}}),R("filters-manager",["string","regex","array-search","extend"],function(a,b,c,d){var e=function(a){this._configure(a||{}),this.rules=[],this.initialize.apply(this,arguments)};return e.extend=d,$.extend(e.prototype,{string:a,regex:b,array:c,options:{baseProperties:["rules","onRulesChange"]}}),_.extend(e.prototype,{initialize:function(){},set:function(a,b){return b=$.extend({silent:!1},b||{}),a?(a.id&&!a.key&&(a.key=a.id),a.key&&(this.rules=_.reject(this.rules,function(b){return b.key==a.key})),a.fromLiveFilters?this.setLiveFilter(a):(this.rules.push(a),b.silent||this.onRulesChange(a),this)):this},onRulesChange:function(){},setLiveFilter:function(a){return this},removeRuleByKey:function(a,b){b=$.extend({silent:!1},b||{});var c=!!_.find(this.rules,function(b){return b.key==a});return c&&(this.ruleToRemove=_.find(this.rules,function(b){return b.key==a}),this.rules=_.reject(this.rules,function(b){return b.key==a}),!b.silent&&this.ruleToRemove&&this.onRulesChange()),this},getRuleByKey:function(a){return _.find(this.rules,function(b){return b.key==a})},getRulesByType:function(a){return _.filter(this.rules,function(b){return b.type==a})},skim:function(a){if(!this.rules.length)return a;for(var b=a,c=0,d=this.rules.length;d>c;c++){var e=this.rules[c];e.disabled||(b=this.applyFilter(b,e))}return b},search:function(a,b,c){if(!b||!a||this.searchDisabled)return a;var d=b instanceof RegExp?b:this.regex.getSearchPattern(this.string.getString(b),c);if(!d)return!1;if(!c.searchProperties)throw"missing search properties";return this.array.searchByStringProperties({pattern:d,properties:c.searchProperties,collection:a,keepSearchDetails:!1})},applyFilter:function(a,b){switch(b.type){case"search":return this.search(a,b.value,b);case"fn":case"function":return _.filter(a,_.partial(b.fn.bind(b.context||this),b))}return a},getExpressions:function(){for(var a=[],b=0,c=this.rules.length;c>b;b++){var d=this.rules[b];if(!d.disabled)switch(d.type){case"search":d.searchProperties&&a.push({type:d.type,expression:this.string.format("{0} like '{1}'",d.searchProperties.join(" or "),d.value)});break;case"function":var e=d.fn.toString(),f=/function\s*\(.*\)\s*{(.+)}/,g=e.match(f);a.push({type:d.type,expression:g?$.trim(g[1]):e})}}return a},reset:function(){for(var a;a=this.rules.shift();)a.onReset&&a.onReset.call(this);return this},_configure:function(a){this.options&&(a=_.extend({},_.result(this,"options"),a)),_.extend(this,_.pick(a,this.options.baseProperties)),this.options=a}}),e}),R("kingtable-core",["extend","events","string","regex","array-search","query","object-analyzer","sanitizer","filters-manager","csv","xml","file"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(a,b){var c=this;b&&_.extend(c,b),c.mergeOptions(a).coreInit().initialize()};return m.extend=a,m.Utils={},m.Utils.String=c,m.Utils.Regex=d,m.Utils.Array=e,m.Utils.Analyzer=g,m.Utils.Sanitizer=h,m.Utils.FiltersManager=i,m.Schemas={DefaultByType:{number:function(a,b){return{format:function(a){return a+""}}},date:function(a,b){return{format:function(a){return this.date.format(a,"dd/MM/yyyy hh:mm")}}}},DefaultByName:{id:{name:"id",type:"id",hidden:!0,secret:!0},guid:{name:"guid",type:"guid",hidden:!0,secret:!0}}},_.extend(m.prototype,b,{initialize:function(){},baseProperties:["initialize","$el","data","fixed"],mergeOptions:function(a){for(var b=this,c=0,d=b.baseProperties.length;d>c;c++){var e=b.baseProperties[c];a.hasOwnProperty(e)&&(b[e]=a[e],delete a[e])}return b.options=_.defaults({},a||{},_.result(b,"defaults")),b},set:function(a,b){var c=this;return"object"==typeof a?(_.each(a,function(a,b){c.set(b,a)}),c):(c[a]=b,c)},multitable:!0,defaults:{rowCount:!0,columnDefault:{name:"",type:"text",groupable:!0,sortable:!0,resizable:!0,allowSearch:!0,template:"##Name##",hidden:!1},allowSearch:!0,minSearchChars:3,searchDelay:50,filtersWizard:!1,useQueryString:!0,useLocalStorage:!0,searchQueryString:"search",resultsPerPageQueryString:"size",resultsPerPageStorageKey:"kt-results-per-page",columnsOrderStorageKey:"kt-columns-order",pageQueryString:"page",page:1,resultsPerPage:30,resultsPerPageSelect:[10,30,50,100],tools:null,paginationEnabled:!0,analyzeLimit:1,autoHighlightSearchProperties:!0,formattedSuffix:"_formatted",fixed:!1,search:"",searchMode:"FullString",getIdProperty:function(){var a=this.columns;if(!a||!a.length)return"id";for(var b=0,c=a.length;c>b;b++){var d=a[b].name;if(/^_?id$|^_?guid$/i.test(d))return d}throw new Error("jQuery-KingTable: cannot guess which property should be used as id. Please specify the getIdProperty function; to return the id property.")},autorefresh:!0,exportFormats:[{name:"Csv",format:"csv",type:"text/csv"},{name:"Json",format:"json",type:"application/json"},{name:"Xml",format:"xml",type:"text/xml"}],prettyXml:!0},string:c,query:f,json:function(a){return JSON.stringify(a)},raiseError:function(a){throw new Error("jQuery-KingTable: "+a+". Please refer to official documentation at https://github.com/RobertoPrevato/jQuery-KingTable")},coreInit:function(){var a=this,b=a.options;a.cid=_.uniqueId("c"),a.cache={},a.data&&(a.fixed=!0),a.objAnalyzer=new g,a.filters=new i,a.sanitizer=new h,a.fixed||(a.filters.searchDisabled=!0),window.localStorage||(b.useLocalStorage=!1),b.allowSearch&&(a.searchCore=a.getSearchHandler()),a.multitable&&b.useQueryString&&_.each(["pageQueryString","searchQueryString","resultsPerPageQueryString"],function(c){b[c]=b[c]+a.cid}),a.customFilters={},a.loadSettings().checkHash(),a.setPagination();var c="connectorInit";return a[c]&&a[c](),a},loadSettings:function(){var a=this,b=a.options;if(b.useQueryString){var c=a.query.get(b.searchQueryString);c&&(b.search=c,a.setSearchFilter(c)),c=a.query.get(b.pageQueryString),c?b.page=parseInt(c):f.set(b.pageQueryString,b.page),c=a.query.get(b.resultsPerPageQueryString),c&&(b.resultsPerPage=parseInt(c));var d,e=[b.searchQueryString,b.pageQueryString,b.resultsPerPageQueryString],g=a.query.getAll();for(d in g)_.contains(e,d)&&delete g[d];_.extend(a.customFilters,g)}return b.useLocalStorage&&(c=window.localStorage.getItem(b.resultsPerPageStorageKey),c&&(b.resultsPerPage=parseInt(c),b.useQueryString&&f.set(b.resultsPerPageQueryString,c))),a},checkHash:function(){return this.options.useQueryString?($(window).on("hashchange.kingtable"+this.cid,_.bind(function(){var a=this,b=a.options,c=a.pagination,d=c.page,e=c.resultsPerPage,g=c.search,h=f.get(b.pageQueryString),i=f.get(b.resultsPerPageQueryString),j=f.get(b.searchQueryString)||"";h?(h=parseInt(h),isNaN(h)||1>h||h>c.totalPageCount?f.set(b.pageQueryString,d):d!==h&&(c.page=h,a.onPageChange())):1!==d&&(c.page=1,a.onPageChange()),i?(i=parseInt(i),isNaN(i)||!_.contains(b.resultsPerPageSelect,i)?f.set(b.resultsPerPageQueryString,e):e!==i&&(c.resultsPerPage=i,a.onResultsPerPageChange(),a.onPageChange())):e!==b.resultsPerPage&&(c.resultsPerPage=b.resultsPerPage,a.onResultsPerPageChange(),a.onPageChange()),j!==g&&(c.search=j||"",j||a.onSearchEmpty(),a.trigger("search-qs-change"))},this)),this):this},render:function(){var a=new $.Deferred,b=this;if(b.fixed&&b.hasData())a.resolveWith(b,[b.data,!0]);else{var c=b.lastFetchTimestamp=(new Date).getTime();b.anchorTimestamp||(b.anchorTimestamp=c),b.loadData(null,c).done(function(c,d){return c&&(c.length||b.columnsInitialized)?void a.resolveWith(b,[c,d]):(b.pendingRender=a,void b.trigger("missing-data"))})}return a.done(function(a,c){b.beforeRender&&b.beforeRender(),b.initializeColumns().formatData().sortColumns().setTools(),b.build(c),b.afterRender&&b.afterRender()}),a.promise()},hasData:function(){var a=this.data;return a&&a.length},mixinAjaxPostData:function(a){var b=this;return _.extend(b.getFilters(),b.options.postData||{})},getFilters:function(){var a=this,b=a.pagination;return _.extend({fixed:a.fixed||!1,page:b.page,size:b.resultsPerPage,orderBy:b.orderBy||"",sortOrder:b.sortOrder||"",search:b.search,timestamp:a.anchorTimestamp},a.customFilters)},loadData:function(a,b){a=a||{};var c=new $.Deferred,d=this;if(a.nofetch||d.fixed&&d.hasData())c.resolveWith(d,[d.data,!0]);else{var e=d.options.url;e||d.raiseError("Missing data, or url option to fetch data");var f=d.mixinAjaxPostData(a,b);d.getFetchPromise({url:e,data:f}).done(function(a){b<d.lastFetchTimestamp||(_.isArray(a)?(d.fixed=!0,d.filters.searchDisabled=!1,d.columnsInitialized&&d.formatData(a),d.data=a,d.updatePagination(a.length),c.resolveWith(d,[a,!1])):(a.subset||d.raiseError("The returned object is not a catalog"),d.columnsInitialized&&d.formatData(a.subset),a.search&&(d.cache.lastFetchFilter=d.filters.regex.getMatchPattern(a.search)),d.data=a.subset,"number"!=typeof a.total&&d.raiseError("Missing total items count in response object. Please provide the total rows count inside the catalog page response object"),d.updatePagination(a.total),c.resolveWith(d,[a.subset,!1])),d.checkPendingRender())}).fail(function(){b<d.lastFetchTimestamp||(d.onFetchError(),d.trigger("error","ajax"))})}return c.promise()},checkPendingRender:function(){var a=this,b=a.pendingRender;return b&&a.hasData()&&(b.resolveWith([a]),a.pendingRender=null),a},getFetchPromise:function(a){var b=this;return a.context=b,b.onFetchStart(),b.postJson(a).always(function(){b.onFetchEnd()})},onFetchStart:function(){},onFetchEnd:function(){},onFetchError:function(){},postJson:function(a){return _.extend(a,{type:"POST",dataType:"json",contentType:"application/json"}),_.isString(a.data)||(a.data=this.json(a.data)),$.ajax(a)},goToFirst:function(){return this.pagination.page=1,this.onPageChange()},goToLast:function(){return this.pagination.page=this.pagination.totalPageCount,this.onPageChange()},goToNext:function(){var a=this,b=a.pagination.page+1;return a.validPage(b)&&(a.pagination.page=b,a.onPageChange()),a},goToPrev:function(){var a=this,b=a.pagination.page-1;return a.validPage(b)&&(a.pagination.page=b,a.onPageChange()),a},onPageChange:function(){return this.storePage()},onResultsPerPageChange:function(){var a=this,b=a.options,c=a.pagination.resultsPerPage;return b.useLocalStorage&&window.localStorage&&window.localStorage.setItem(b.resultsPerPageStorageKey,c),b.useQueryString&&a.query.set(b.resultsPerPageQueryString,c),a},storePage:function(){var a=this,b=a.pagination.page;return a.options.useQueryString&&a.query.set(a.options.pageQueryString,b),a},validPage:function(a){var b=this.pagination;return!(isNaN(a)||1>a||a>b.totalPageCount||a===b.page)},getObjectSchema:function(){var a=this,b=a.options.analyzeLimit;return a.objAnalyzer.getCollectionStructure(a.data,{clear:!1,limit:b})},getMemory:function(a){var b=this,c=b.getKey(b.options[a]);return localStorage.getItem(c)},setMemory:function(a,b){var c=this,d=c.getKey(c.options[a]);return localStorage.setItem(d,b)},getColumnsPositionData:function(){var a=this,b=a.getMemory("columnsOrderStorageKey");try{if(b)return JSON.parse(b)}catch(c){}return null},initializeColumns:function(){var a="columnsInitialized",b=this;if(b[a]||!b.hasData())return this;b[a]=!0;var c=[],d=b.getColumnsPositionData(),e=b.getObjectSchema(),f=b.options.columns;if(f)for(var g in f)_.isString(f[g])&&(f[g]={displayName:f[g]});for(var g in e){var h={name:g},i=e[g],j=i.type;j||(i.type=j="string");var k=_.extend({},b.options.columnDefault,h,i);k.cid=_.uniqueId("col"),j=j.toLowerCase();var l=$.KingTable.Schemas.DefaultByType;if(l.hasOwnProperty(j)&&_.extend(h,l[j].call(b,i,e)),l=$.KingTable.Schemas.DefaultByName,l.hasOwnProperty(g)&&_.extend(h,l[g]),_.extend(k,h),f){var m=_.isArray(f)?_.find(f,function(a){return a.name==g}):f[g];m&&_.extend(k,m)}k.template=k.template.replace(/##\s*Name\s*##/,"{{"+g+"}}"),d&&(k.position=_.indexOf(d,g)),_.isString(k.displayName)||(k.displayName=k.name),c.push(k)}if(f){var n=0,o="position";for(var g in f){var k=_.find(c,function(a){return a.name==g});k&&!k.hasOwnProperty(o)&&(k[o]=n),n++}}return b.setColumns(c),b.columns.formatted=[],b},formatData:function(){return this},sortColumns:function(){var a=_.isNumber,b=this.columns;b.sort(function(b,d){var e="position";return a(b[e])&&!a(d[e])?-1:!a(b[e])&&a(d[e])?1:b[e]>d[e]?1:b[e]<d[e]?-1:(e="displayName",c.compare(b[e],d[e],1))});for(var d=0,e=b.length;e>d;d++)b[d].position=d;return this},setTools:function(){var a=this,b=a.options.tools,c=[{name:I.t("voc.Columns"),menu:{id:"columns-menu",items:_(a.columns).reject(function(a){return a.secret===!0}).map(function(a){return{name:a.displayName,checked:!a.hidden,type:"checkbox",attr:{name:a.name,"class":"visibility-check"}}}).value()}},a.getExportTools()];return b&&(c=c.concat(b.call(a))),a.tools=c,a},getExportTools:function(){var a=this.options.exportFormats;return a?(_.each(a,function(a){_.extend(a,{attr:{css:"export-btn","data-format":a.format}})}),l.supportsCsExport()?{name:I.t("voc.Export"),menu:{items:a}}:null):null},setColumns:function(a){return this.columns=a,this},setPagination:function(){var a=this.data,b=this.options,c=b.page,d=+b.resultsPerPage,e=+b.totalRowsCount||(a?a.length:0),f=c*d-d+1,g=c*d,h=self.pagination?self.pagination.search:"";return this.pagination={page:b.page,firstPage:1,resultsPerPage:d,totalRowsCount:e,totalPageCount:this.getPageCount(e,d),resultsPerPageSelect:b.resultsPerPageSelect,allowSearch:b.allowSearch,filtersWizard:b.filtersWizard,filterProperties:b.filterProperties,search:h||b.search,firstObjectNumber:f,lastObjectNumber:g,orderBy:b.orderBy,sortOrder:b.sortOrder},this},getPageCount:function(a,b){return a>b?a%b==0?a/b:Math.ceil(a/b):1},setRowCount:function(a){var b=this,c=b.pagination,d=b.fixed?0:(c.page-1)*c.resultsPerPage;a||(a=b.data);for(var e=0,f=a.length;f>e;e++)a[e].rowCount=e+1+d;return a},getRowsToDisplay:function(a){a=a||{};var b=new $.Deferred,c=this,d=c.lastFetchTimestamp=(new Date).getTime();return c.loadData(a,d).done(function(a){
c.ensureSearchFilter();var a=c.filters.skim(a);c.fixed&&(c.updatePagination(a.length),c.sortClientSide(a)),c.setRowCount(a),b.resolveWith(c,[c.data.length>c.pagination.resultsPerPage&&c.options.paginationEnabled?c.getSubSet(a):a])}),b.promise()},sortClientSide:function(a){var b=this,c=b.pagination,d=c.orderBy,e=c.sortOrder;return d?($.KingTable.Utils.Array.sortByProperty(a,d,e),a):a},updatePagination:function(a){var b=this;if(b.pagination||b.setPagination(),!_.isNumber(a))throw"invalid type";var c=b.pagination;if(c.totalRowsCount!==a){c.totalRowsCount=a;var d=b.getPageCount(a,c.resultsPerPage);c.totalPageCount=d,d<c.page&&(c.page=1,b.onPageChange())}return c.firstObjectNumber=c.page*c.resultsPerPage-c.resultsPerPage+1,c.lastObjectNumber=c.page*c.resultsPerPage,b.onResultsCountChange&&b.onResultsCountChange(),b},getSubSet:function(a){var b=this.pagination,c=(b.page-1)*b.resultsPerPage,d=b.resultsPerPage+c;return a.slice(c,d)},validateForSeach:function(a){var b=this.options.minSearchChars;return a.match(/^[\s]+$/g)||_.isNumber(b)&&a.length<b?!1:!0},getSearchProperties:function(){var a=this;if(a.options.searchProperties)return a.options.searchProperties;if(!a.data)return!1;var b=a.data[0],c=a.options.searchProperties=a.objAnalyzer.guessSearchableProperties(b);return _.reject(c,function(b){var c=_.find(a.columns,function(a){return a.name==b});return c&&0==c.allowSearch?!0:!1})},dispose:function(){var a=this;return delete a.columns,$(window).off("hashchange.kingtable"+a.cid),a.trigger("dispose"),a},ensureSearchFilter:function(){var a=this.pagination.search;return a&&!this.filters.getRuleByKey("search")&&this.setSearchFilter(a),this},setSearchFilter:function(a){var b=this;b.pagination||(b.pagination={}),b.pagination.search=a;var c=b.getSearchProperties();return c&&c.length&&b.filters.set({type:"search",key:"search",value:a,searchProperties:c,searchMode:b.options.searchMode}),b},onSearchStart:function(a){return this.options.useQueryString&&this.query.set(this.options.searchQueryString,a),this},onSearchEmpty:function(){var a=this;return a.filters.removeRuleByKey("search"),a.options.useQueryString&&a.query.set(a.options.searchQueryString,""),a.pagination.search="",a},sortBy:function(a){var b=this,c=b.pagination,d=c.orderBy,e=c.sortOrder,f=d==a.name&&"asc"==e?"desc":"asc";return c.orderBy=a.name,c.sortOrder=f,b.refresh(),this},getKey:function(a){return"undefined"!=typeof location?location.pathname+a:a},saveColumnsOrder:function(){var a=this,b=_.map(a.columns,function(a){return a.name});return a.setMemory("columnsOrderStorageKey",a.json(b)),a},getExportFileName:function(a){return _.result(this.options,"collectionName","data")+"."+a},optimizeCollection:function(a){for(var b=this.columns,c=[_.map(b,function(a){return a.displayName})],d="length",e="push",f=0,g=a[d];g>f;f++){for(var h=[],i=0,j=b[d];j>i;i++)h[e](a[f][b[i].name]);c[e](h)}return c},exportTo:function(a){if(!a)throw"missing format";var b=this,c=b.getExportFileName(a),d=_.find(b.options.exportFormats,function(b){return b.format===a});if(!d||!d.type)throw"missing format information";b.getRowsToDisplay().done(function(e){var f="";if(d.handler)f=d.handler.call(b,e);else switch(a){case"csv":var g=b.optimizeCollection(e);f=j.serialize(g);break;case"json":f=JSON.stringify(e,2,2);break;case"xml":f=b.dataToXml(e);break;default:throw"export format "+a+"not implemented"}f&&l.exportfile(c,f,d.type)})},dataToXml:function(a){for(var b=this,c=b.columns,d=b.options,e="length",f=document,g=new XMLSerializer,h="createElement",i="appendChild",j=f[h](d.collectionName||"collection"),l=0,m=a[e];m>l;l++){for(var n=f[h](d.entityName||"item"),o=0,p=c[e];p>o;o++){var q=c[o],r=q.name,s=a[l][r];if(d.entityUseProperties)n.setAttribute(r,s);else{var t=f[h](r);t.innerText=s,n[i](t)}}j[i](n)}var u=g.serializeToString(j);return d.prettyXml?k.pretty(u):k.normal(u)}}),m}),R("jquery-kingtable",["kingtable-core"],function(a){$.KingTable=a;var b={init:function(b){if(!b)throw new Error("missing options to set up a king table");var c=new a(_.extend({$el:$(this)},b));return this.data("king-table",c),c.render(),this},collection:function(){var a=this.data("king-table");return a&&a.data,[]},dispose:function(){var a=this.data("king-table");return a&&a.dispose(),this}};$.fn.kingtable=function(a){return this.length?b[a]?b[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void $.error('Method "'+a+'" does not exist on jQuery-KingTable.'):b.init.apply(this,arguments):this}}),R("kingtable-lodash",["kingtable-core","menu","i18n"],function(a,b,c){var d={"click .pagination-bar-first-page":"goToFirst","click .pagination-bar-last-page":"goToLast","click .pagination-bar-prev-page":"goToPrev","click .pagination-bar-next-page":"goToNext","click .pagination-bar-refresh":"refresh","change .pagination-bar-page-number":"changePage","change .pagination-bar-results-select":"changeResultsNumber","click .btn-advanced-filters":"toggleAdvancedFilters","click .btn-clear-filters":"clearFilters","click .ui-expander":"expandMenu","click .ui-submenu":"expandSubMenu","click .king-table-head th":"sort","click .resize-handler":"toggleColumnResize","keyup .search-field":"onSearchKeyUp","paste .search-field, cut .search-field":"onSearchChange","click .btn-filters-wizard":"openFiltersDialog","keyup .filters-region input[type='text']":"viewToModel","keyup .filters-region textarea":"viewToModel","change .filters-region input[type='checkbox']":"viewToModel","change .filters-region input[type='radio']":"viewToModel","change .filters-region select":"viewToModel","keydown span[tabindex]":"checkEnter","change .visibility-check":"onColumnVisibilityChange","click .export-btn":"onExportClick"};_.extend(a.prototype.defaults,{rowTagName:"tr",headCellTagName:"th",keepCellsWidth:!0,editableCheckboxes:!1,templateHelpers:null,events:null,filtersView:null,filtersViewExpandable:!0,filtersViewOpen:!1,filtersViewAppearance:"slide"}),_.extend(a.Schemas.DefaultByType,{"boolean":function(a,b){var c=this.editableCheckboxes;return{sortable:!0,template:'<input class="ajax-checkbox" name="'+a.name+'" type="checkbox"{% if('+a.name+') {%} checked="checked"{% } %}'+(c?"":' disabled="disabled" readonly="readonly"')+" />",position:990}}});var e="string"==typeof _.template("_",{})?0:1;_.extend(a.prototype,b.functions,{connectorInit:function(){return this.on("missing-data",function(){this.buildSkeleton().buildPagination().showEmptyView().focusSearchField()})},template:function(a,b){var c=$.KingTable.Templates[a],d=this.templateHelpers(),f=_.extend({},b,d);switch(e){case 0:return _.template(c,f);case 1:if(_.isFunction(c))return c(f);var g=$.KingTable.Templates[a]=_.template(c,d);return g(f)}},templateSafe:function(a,b){var c=_.extend(b,this.templateHelpers());switch(e){case 0:return _.template(a,c);case 1:var d=_.template(a,c);return d(b)}},refresh:function(){return this.buildPaginationControls().buildBody()},build:function(a){var b=this;b.buildSkeleton().buildHead().buildPagination().buildTools().buildHead().buildBody({nofetch:!a}).focusSearchField(),b.on("search-qs-change",function(){b.buildPagination().buildBody().focusSearchField()})},buildSkeleton:function(){var a=this,b="skeletonInitialized";if(a[b])return a;a[b]=!0;var c=a.getTemplate(),d=$(c);if(!a.$el||!a.$el.length)throw new Error("KingTable: the table is not bound to any element; it must be bound to a container element.");var e=a.options.id;return e&&d.attr("id",e),a.$el.html(d),a.bindUiElements(),a},focusSearchField:function(){var a=this;return _.delay(function(){var b=$(".search-field").trigger("focus"),c=a.pagination.search;c&&(b.get(0).selectionStart=c.length)},50),a},getTemplate:function(){return $.KingTable.Templates["king-table-base"]},buildHead:function(){var a=this,b=a.options,c=b.rowTagName||"tr",d=b.headCellTagName||"th",e="<"+d+' class="row-number"></'+d+">",f=["<"+c+">"],g=a.columns;return f.push(e),e="<"+d+"></"+d+">",b.detailRoute&&f.push(e),_.each(g,function(c){c.hidden||f.push(a.template("king-table-head-cell",_.extend(c,{sort:b.orderBy==c.name?b.sortOrder:""})))}),f.push("</"+c+">"),a.$el.find(".king-table-head").html(f.join("")),b.keepCellsWidth&&_.delay(function(){a.$el.find(".king-table-head th").each(function(){var a=$(this),b="width";a[b](a[b]())})},20),a},buildPagination:function(){var a=this;return a.options.paginationEnabled?(a.$el.find(".pagination-bar").html(a.template("pagination-bar-layout")),a.buildPaginationControls().buildFiltersControls()):a},buildTools:function(){var a=this,c=b.builder(a.tools);return a.$el.find(".tools-region").append(c),a.onToolsBuilt()},onToolsBuilt:function(){var a=this;return $.fn.sortable&&$("#columns-menu").sortable({update:function(b,c){var d=a.columns,e=$(b.target).find("[name]").map(function(a,b){return b.name}),f=_.indexOf,g="name";d.sort(function(a,b){return f(e,a[g])>f(e,b[g])?1:f(e,a[g])<f(e,b[g])?-1:0}),a.saveColumnsOrder().buildHead().buildBody({nofetch:!0})}}),a},keepFocus:function(a){var b=a.find(":focus");return b.length&&_.defer(function(){a.find("[class='"+b.attr("class")+"']").trigger("focus")}),this},rebuild:function(a,b,c){return this.keepFocus(a),a.html(this.template(b,c)),this},buildPaginationControls:function(){return this.rebuild(this.$el.find(".pagination-bar-buttons"),"pagination-bar-buttons",this.pagination)},buildFiltersControls:function(){var a=this,b=a.options,c=b.filtersView,d=_.extend({},a.pagination,{advancedFiltersButton:c&&b.filtersViewExpandable}),e=a.$el.find(".pagination-bar-filters"),f=a.$el.find(".filters-region");if(a.rebuild(e,"pagination-bar-filters",d),c){var g=a.getCustomFiltersView(c),h=a.customFilters,i=a.templateSafe(g,h),j=a.modelToView(h,i);(!b.filtersViewExpandable||b.filtersViewOpen)&&(f.show(),a.customFiltersVisible=!0),a.trigger("on-filters-render",j),f.html(j)}return a},getCustomFiltersView:function(a){var b=document.getElementById(a);if(null!=b)return b.innerText;if($.KingTable.Templates.hasOwnProperty(a))return $.KingTable.Templates[a];if(_.isString(a))return a;throw new Error("KingTable: cannot obtain the custom filters view.")},buildBody:function(a){var b=this;return b.getRowsToDisplay(a).done(function(a){if(!a.length)return b.showEmptyView();var c=[],d=b.getRowTemplate();_.each(a,function(a){c.push(b.templateSafe(d,a))}),b.$el.find(".king-table-body").html(c.join(""))}),b},showEmptyView:function(){var a=this,b=a.columns,c=a.templateSafe($.KingTable.Templates["king-table-empty-view"],{colspan:b?b.length+1:1});return this.$el.find(".king-table-body").html(c),this},bindUiElements:function(){return this.delegateEvents().bindWindowEvents()},anyMenuIsOpen:function(){return!!$(".ui-menu:visible").length},anyInputFocused:function(){var a=document.activeElement;return a&&/input|select|textarea/i.test(a.tagName)},bindWindowEvents:function(){var a=this;return $("body").on("keydown.king-table",function(b){if(a.anyInputFocused()||a.anyMenuIsOpen())return!0;var c=b.keyCode;_.contains([37,65],c)&&a.goToPrev(),_.contains([39,68],c)&&a.goToNext()}),a.on("dispose",function(){$("body").off("keydown.king-table")}),a},getGoToDetailsLink:function(){var a=this,b="td",c=a.options,d=c.getIdProperty(),e=c.detailRoute;return a.string.format('<{0} class="{1}"><a href="{2}{{'+d+'}}"><span class="oi" data-glyph="document" title="{{I.t(\'voc.GoToDetailsLink\')}}" aria-hidden="true"></span></a></{0}>',b,"detail-link",e)},getRowTemplate:function(){var a=[],b=this,c=b.options,d="tr",e="td";b.columnsInitialized||b.initializeColumns(),a.push(b.string.format("<{0}>",d)),c.rowCount&&a.push(b.string.format('<{0} class="{1}">{{rowCount}}</{0}>',e,"row-number")),c.detailRoute&&a.push(b.getGoToDetailsLink());for(var f=b.filters.getRuleByKey("search"),g=0,h=b.columns.length;h>g;g++){var i=b.columns[g];if(!i.hidden&&i.template){if(i.allowSearch){var j=b.doesTemplateLookSearchable(i);j||(i.allowSearch=!1)}var k=_.contains(b.columns.formatted,i.name)?i.name+b.options.formattedSuffix:i.name;a.push(this.string.format("<{0}>",e)),f&&c.autoHighlightSearchProperties&&i.allowSearch&&!/\$highlight/.test(i.template)?a.push("{%print($highlight("+k+"))%}"):a.push(i.template),a.push(this.string.format("</{0}>",e))}}a.push(this.string.format("</{0}>",d));var l=a.join("");return l},doesTemplateLookSearchable:function(a){if(/\$highlight/.test(a.template))return!0;var b=a.name,c=new RegExp("(src|href)=['\"].*{{"+b+"}}.*['\"]");return-1==a.template.search(c)},getEvents:function(){var a=this.events||{};return _.isFunction(a)&&(a=a.call(this)),_.extend({},d,a,this.options.events)},delegateEvents:function(){var a=this,b=a.getEvents(),c=/^(\S+)\s*(.*)$/;a.undelegateEvents();for(var d in b){var e=b[d],f=e;if(_.isFunction(f)||(f=a[f]),!f&&a.options.hasOwnProperty(e)&&(f=a.options[e]),!f)throw new Error("method not defined inside the model: "+b[d]);var g=d.match(c),h=g[1],i=g[2];f=_.bind(f,a),h+=".delegate",""===i?a.$el.on(h,f):a.$el.on(h,i,f)}return a},undelegateEvents:function(){return this.$el.off(".delegate"),this},changePage:function(a){var b=parseInt(a.currentTarget.value),c=this,d=c.pagination.page;c.validPage(b)?(c.pagination.page=b,c.onPageChange()):a.currentTarget.value=d},changeResultsNumber:function(a){var b=parseInt(a.currentTarget.value),c=this.pagination;c.resultsPerPage=b,c.totalPageCount=this.getPageCount(c.totalRowsCount,b),this.onResultsPerPageChange(),this.buildPaginationControls().buildBody()},onPageChange:function(){this.storePage().buildPaginationControls().buildBody()},sort:function(a){var b=$(a.currentTarget),c=b.find(".oi"),d=b.data("id"),e=_.find(this.columns,function(a){return a.cid==d});if(!e||!e.sortable)return!0;b.siblings().find(".oi").attr("data-glyph","");var f="sort-ascending"==c.attr("data-glyph")?"desc":"asc";c.attr("data-glyph","sort-"+f+"ending"),this.sortBy(e)},onFetchStart:function(){this.showPreloader()},onFetchEnd:function(){this.hidePreloader()},onFetchError:function(){var a=this,b=a.templateSafe($.KingTable.Templates["king-table-error-view"],{message:c.t("voc.ErrorLoadingContents"),colspan:a.columns?a.columns.length+1:1});return a.$el.find(".king-table-body").html(b),a},toggleColumnResize:function(a){var b=this,c=$(a.currentTarget).closest("th");if("col-resize"==b.mode)return b.unsetMode(),!1;b.mode="col-resize",b.unsetMode=b.stopResize;var d=c.position();return b.$el.css({cursor:"col-resize"}).on("mousemove.resize",function(a){if(!(a.clientX-10<d.left)){var b=a.clientX-d.left;0>b&&(b=0),c.width(b)}}),_.delay(function(){$(document).one("mouseup.resize",function(){return b.stopResize(),!1})},50),!1},stopResize:function(){return this.mode="",this.$el.css({cursor:"default"}).off("mousemove.resize"),$(document).off("mouseup.resize"),this},getSearchHandler:function(){return _.debounce(function(a){if(a){var b=_.isString(a)?a:a.val(),c=this;c.validateForSeach(b)?(0===b.length?(c.onSearchEmpty(),c.filters.removeRuleByKey("search")):(c.onSearchStart(b),c.setSearchFilter(b)),c.pagination.page=1,c.refresh()):(c.onSearchEmpty(),c.filters.removeRuleByKey("search"),c.refresh())}},this.options.searchDelay)},validateSearchEventKey:function(a){for(var b=a.keyCode?a.keyCode:a.charCode,c=[9,13,16,17,18,20,27,33,34,35,36,37,38,39,40,91],d=0,e=c.length;e>d;d++)if(b==c[d])return!1;return!0},onSearchKeyUp:function(a){var b=$(a.currentTarget),c=this;return b.hasClass("ui-disabled")?!0:(b.val()||c.onSearchEmpty(),c.validateSearchEventKey(a)&&c.searchCore(b),!0)},onResultsCountChange:function(){return this.buildPaginationControls()},onSearchChange:function(a){var b=$(a.currentTarget),c=this;_.delay(function(){c.searchCore(b)},50)},showPreloader:function(a){_.isNumber(a)||(a=300);var b=this;b.unsetDelayedPreloader(),b.cache.delayedpreloader=window.setTimeout(function(){if(b.cache.delayedpreloader){var a="king-table-preloader",c=$($.KingTable.Templates[a]).addClass(a);b.$el.find(".king-table-container").append(c)}},a)},hidePreloader:function(){var a=this;a.unsetDelayedPreloader(),a.$el.find(".king-table-container .king-table-preloader").remove()},unsetDelayedPreloader:function(){var a=this.cache,b="delayedpreloader";return a[b]&&(window.clearTimeout(a[b]),delete a[b]),this},templateHelpers:function(){var a={escape:/\{\{(.+?)\}\}/g,evaluate:/\{%(.+?)%\}/g,interpolate:/\{#(.+?)#\}/g},b=this,d=b.filters.getRuleByKey("search"),e=d?new RegExp("("+$.KingTable.Utils.Regex.escapeCharsForRegex(d.value)+")","gi"):null;return _.extend({$i:function(a){return c.t(a)},$highlight:function(a){return a?e?("string"!=typeof a&&(a+=""),a.replace(e,'<span class="ui-search-highlight">$1</span>')):a:""},$relwidth:function(a,b,c){var d=c/b;return Math.ceil(d*a)},$relheight:function(a,b,c){var d=c/a;return Math.ceil(d*b)},$attr:function(a){var b="";if(!a)return b;var c=a.attr;if(!c)return b;var d=[],e='"';for(var f in c)d.push([f,"=",e,c[f],e].join(b));return d.join(" ")}},b.options.templateHelpers,a)},openFiltersDialog:function(){},unsetValues:function(a){return a.find("input[type='text'],textarea,select").val(""),a.find("input[type='checkbox'],input[type='radio']").each(function(){this.checked=!1}),this},setValueInElement:function(a,b){return a?(!a instanceof $&&(a=$(a)),a.each(function(){var a=this,c=$(a),d=a.type;switch(a.tagName.toLowerCase()){case"input":"checkbox"==d?a.checked=b?!0:!1:"radio"==d?a.checked=b==a.value:c.val(b);break;default:c.val(b)}}),this):this},modelToView:function(a,b){_.isString(b)&&(b=$(b));var c,d=this;d.schema;for(c in a){var e=b.find('[name="'+c+'"]');e.length&&d.setValueInElement(e,a[c])}return b},viewToModel:function(a){var b,c=this,d=a.currentTarget,e=d.type,f=$(d),g=f.attr("name");if(g&&!f.hasClass("search-field")){b="checkbox"==e?d.checked:f.val();var h="customFilters";c[h]||(c[h]={}),c[h][g]=b,c.fixed&&c.tryApplyClientSideFilter(g,b),c.options.useQueryString&&c.query.set(g,b),c.options.autorefresh&&c.refresh()}},tryApplyClientSideFilter:function(a,b){if(_.isUndefined(b)||_.isNull(b))return this.filters.removeRuleByKey(a);var c=this,d=c.options.filters;if(!d)throw"KingTable: missing filtering functions for a fixed table.";var e=d[a];if(!e)throw"KingTable: missing filter definition for: "+a;if(_.isFunction(e))c.filters.set({type:"fn",key:a,value:b,fn:e});else{if(!_.isPlainObject(e))throw"KingTable: invalid filter definition for: "+a;c.filters.set(_.extend({key:a,value:b},e))}return c},toggleAdvancedFilters:function(){var a=this,b=a.$el.find(".filters-region");a.customFiltersVisible?(a.customFiltersVisible=!1,b.hide()):(a.customFiltersVisible=!0,b.show())},clearFilters:function(){var a=this,b=a.$el.find(".filters-region"),c=a.customFilters;if($.isEmptyObject(c))return!0;a.customFilters={};var d=b.find("input[name]").map(function(a,b){return b.name});_.each(d,function(b){a.query.set(b,""),a.filters.removeRuleByKey(b)}),a.unsetValues(b),a.refresh()},checkEnter:function(a){var b=$(a.currentTarget);b.is(":visible")&&13==a.which&&b.click()},onColumnVisibilityChange:function(a){var b=this,c=a.currentTarget,d=c.name,e=_.find(b.columns,function(a){return a.name===d});return e&&(e.hidden=!c.checked),b.buildHead().buildBody({nofetch:!0})},onExportClick:function(a){var b=$(a.currentTarget),c=b.data("format");if(!c)throw"missing [data-format]";this.exportTo(c)}})}),$.KingTable.Templates||($.KingTable.Templates={}),function(a){var b,c={"king-table-preloader":'<div class="preloader-mask"> <div class="preloader-icon"></div> </div>',"king-table-empty-view":'<tr class="king-table-empty"> <td colspan="{{colspan}}">{{$i("voc.NoResults")}}</td> </tr>',"king-table-head-cell":'<th data-id="{{cid}}" class="{% if (obj.sortable) { %} sortable{%}%}"> {% if (name) { %} <div> <span>{{displayName}}</span> <span class="oi" data-glyph="{% if (obj.sort) { %}sort-{{obj.sort}}ending{%}%}" aria-hidden="true"></span> {% if (obj.resizable) { %} <span class="resize-handler"></span> {% } %} </div> {% } %} </th>',"king-table-empty-cell":"<th></th>","king-table-base":'<div class="king-table-region"> <div class="pagination-bar"></div> <div class="filters-region"></div> <div class="king-table-container"> <table class="king-table"> <thead class="king-table-head"></thead> <tbody class="king-table-body"></tbody> </table> </div> </div>',"king-table-error-view":'<tr class="king-table-error"> <td class="message" colspan="{{colspan}}"> <span>{{message}}</span> <span class="oi" data-glyph="warning" aria-hidden="true"></span> </td> </tr>',"pagination-bar-buttons":'{% if (page > firstPage) { %} <span tabindex="0" class="pagination-button pagination-bar-first-page" title="{{$i(\'voc.FirstPage\')}}"></span> <span tabindex="0" class="pagination-button pagination-bar-prev-page" title="{{$i(\'voc.PrevPage\')}}"></span> {% } else { %} <span class="pagination-button-disabled pagination-bar-first-page-disabled"></span> <span class="pagination-button-disabled pagination-bar-prev-page-disabled"></span> {% } %} <span class="separator"></span> <span class="valigned">{{$i(\'voc.Page\')}} </span> {% if (totalPageCount > 1) { %} <input name="page-number" text="text" class="w30 must-integer pagination-bar-page-number" value="{{page}}" /> {% } else { %} <span class="valigned pagination-bar-page-number-disabled">{{page}}</span> {% } %} <span class="valigned total-page-count"> {{$i(\'voc.of\')}} {{totalPageCount}}</span> <span class="separator"></span> <span tabindex="0" class="pagination-button pagination-bar-refresh" title="{{$i(\'voc.Refresh\')}}"></span> <span class="separator"></span> {% if (page < totalPageCount) { %} <span tabindex="0" class="pagination-button pagination-bar-next-page" title="{{$i(\'voc.NextPage\')}}"></span> <span tabindex="0" class="pagination-button pagination-bar-last-page" title="{{$i(\'voc.LastPage\')}}"></span> {% } else { %} <span class="pagination-button-disabled pagination-bar-next-page-disabled"></span> <span class="pagination-button-disabled pagination-bar-last-page-disabled"></span> {% } %} <span class="separator"></span> <span class="valigned">{{$i(\'voc.ResultsPerPage\')}}</span> {% if (totalRowsCount) { %} <select name="pageresults" class="pagination-bar-results-select valigned"{% if (totalRowsCount <= 10) { %} disabled="disabled"{% } %}> {% _.each(resultsPerPageSelect, function (val) { %} <option value="{{val}}"{% if (val == resultsPerPage) { %} selected="selected"{%}%}>{{val}}</option> {% }) %} </select> {% } else { %} <select name="pageresults" class="pagination-bar-results-select valigned" disabled="disabled" readonly="readonly"></select> {% } %} <span class="separator"></span> <span class="valigned m0"> {% if (totalRowsCount) { %} {{$i(\'voc.Results\')}} {{firstObjectNumber}} - {{Math.min(lastObjectNumber, totalRowsCount)}} {{$i(\'voc.of\')}} {{totalRowsCount}} {% } else { %} 0 Results {% } %} </span> <span class="separator"></span>',"pagination-bar-filters":'{% if (allowSearch) { %} <input type="text" class="search-field" value="{{search}}" /> {% } %} {% if (advancedFiltersButton) { %} <button class="btn camo-btn btn-advanced-filters">{{$i("voc.AdvancedFilters")}}</button> {% } %} {% if (filtersWizard) { %} <button class="btn btn-filters-wizard">{{$i("voc.Filters")}}</button> {% } %}',"pagination-bar-layout":'<div class="tools-region"> <span tabindex="0" class="oi ui-expander" data-glyph="cog"></span> </div> <span class="pagination-bar-buttons"></span> <span class="pagination-bar-filters"></span>'};for(b in c)a[b]=c[b]}($.KingTable.Templates);